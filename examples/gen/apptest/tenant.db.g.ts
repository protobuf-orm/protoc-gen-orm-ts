// Code generated by protoc-gen-orm-ts. DO NOT EDIT.

import { create, type MessageInitShape } from "@bufbuild/protobuf";
import { Code } from "@connectrpc/connect";
import type { DbOf, EntityOf, Key, ValueOf } from "@protobuf-orm/runtime";
import { TableBase, uuid } from "@protobuf-orm/runtime";

import type { TenantServiceClient } from "./client.g"
import { type Tenant, TenantSchema } from "./tenant_pb.ts"
import type { TenantGetRequestSchema } from "./tenant_svc.g_pb.ts"

type Desc = typeof TenantSchema
export type Db = DbOf<Desc>

export const TableName = "apptest.Tenant";
export const Schema = "," as const;

export class TableService extends TableBase<Desc> implements Partial<TenantServiceClient> {
	constructor(db: Db) {
		super(db, TenantSchema);
	}

	_dehydrate(v: Tenant): [Key, any] {
		const w = v as unknown as any
		const k = uuid.u8_str(v.id)
		if(k === undefined) throw this._err("invalid key", Code.InvalidArgument)
		w.id = k
		return [k, v]
	}

	_hydrate(v: any): Tenant {
		v.id = uuid.str_u8(v.id)
		return create(this._schema, v)
	}

	get(req: MessageInitShape<typeof TenantGetRequestSchema>): Promise<Tenant> {
		if(req.ref?.key === undefined) return Promise.reject(this._err("key undefined", Code.InvalidArgument));
		const { key } = req.ref;
		switch(key.case) {
			case "id": {
				const k = uuid.u8_str(key.value);
				if(k === undefined) return Promise.reject(this._err("invalid key", Code.InvalidArgument));
				return this._query(t => t.get(k));
			}

			default:
				return Promise.reject(this._err(`unknown key: ${key.case}`, Code.InvalidArgument));
		}
	}
}
